{% extends 'healthbridge_app/base.html' %}
{% load static %}

{% block title %}Dashboard â€¢ HealthBridge{% endblock %}
{% block nav_dashboard_active %}is-active{% endblock %}

{% block content %}
  <h1 class="hb-page-title">Dashboard</h1>

  <div class="hb-grid">
    <!-- Sidebar filters -->
    <aside class="hb-card hb-sidebar">
      <h3 class="hb-sidebar-title">Category</h3>
      <label class="hb-check"><input type="checkbox"> Pain Relief</label>
      <label class="hb-check"><input type="checkbox"> Antibiotics</label>
      <label class="hb-check"><input type="checkbox"> Syrup Relief</label>

      <div class="hb-divider"></div>

      <h3 class="hb-sidebar-title">Condition Treated</h3>
      <div class="hb-select">
        <select>
          <option>Fever</option>
          <option>Allergy</option>
          <option>Hypertension</option>
        </select>
      </div>

      <div class="hb-divider"></div>

      <h3 class="hb-sidebar-title">Form</h3>
      <label class="hb-check"><input type="checkbox"> Tablets/Capsules</label>
      <label class="hb-check"><input type="checkbox"> Syrups/Liquids</label>
      <label class="hb-check"><input type="checkbox"> Stock</label>

      <div class="hb-divider"></div>

      <h3 class="hb-sidebar-title">Availability</h3>
      <label class="hb-check"><input type="checkbox"> Coming Soon</label>
      <label class="hb-check"><input type="checkbox"> In Stock</label>
    </aside>

    <!-- Cards grid -->
    <section class="hb-cards">
      {% static 'healthbridge_app/paracetamol.png' as fallback_img %}

      {% for med in medicines %}
        <article class="hb-card hb-card-product">
          {# Safe image fallback: ImageField -> URL string -> static placeholder #}
          {% if med.image %}
            <img src="{{ med.image.url }}" alt="{{ med.name }}" class="hb-product-img">
          {% elif med.image_url %}
            <img src="{{ med.image_url }}" alt="{{ med.name }}" class="hb-product-img">
          {% else %}
            <img src="{% static 'healthbridge_app/paracetamol.png'}" alt="{{ med.name }}" class="hb-product-img">
          {% endif %}

          <div class="hb-card-body">
            <h3 class="hb-card-title">{{ med.name }}</h3>
            <ul class="hb-meta">
              {% if med.uses %}<li><strong>Uses:</strong> {{ med.uses }}</li>{% endif %}
              <li>
                {% if med.form %}<strong>Form:</strong> {{ med.form }}{% endif %}
                {% if med.expiry %} <span class="hb-dot"></span> <strong>Expiry:</strong> {{ med.expiry|date:"m/Y" }}{% endif %}
              </li>
            </ul>

            <div class="hb-card-actions">
              <a href="{% url 'request_medicine' med.id %}" class="hb-btn hb-btn-primary">Request</a>
            </div>
          </div>
        </article>
      {% empty %}
        <p class="hb-muted">No medicines found.</p>
      {% endfor %}
    </section>
  </div>
{% endblock %}