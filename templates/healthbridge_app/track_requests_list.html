{% extends 'healthbridge_app/base.html' %}
{% load static %}

{% block title %}Track Requests ‚Ä¢ HealthBridge{% endblock %}
{% block nav_dashboard_active %}active{% endblock %}

{% block content %}
<style>
  .list-wrap{
    max-width: 960px; margin: 2rem auto; position: relative;
    background: var(--white); border-radius: 16px; padding: 2rem 1.6rem;
    box-shadow: 0 6px 16px rgba(0,0,0,.08); border: 1px solid #eef2f7;
  }

  /* Back to dashboard */
  .back-btn{
    position:absolute; top: 1rem; left: 1rem;
    display:inline-flex; align-items:center; gap:8px;
    text-decoration:none; font-weight:800;
    color: var(--blue);
    padding:.35rem .6rem; border-radius:.6rem;
    transition: transform .15s ease, background .2s ease;
  }
  .back-btn:hover{ transform: translateX(-2px); background:#f1f5f9; }
  .back-btn svg{ width:16px; height:16px }

  .list-head{ text-align:center; margin: .5rem 0 1.5rem; }
  .list-head h2{ margin:0 0 .25rem; color:#0b1220; font-size:1.6rem; }
  .list-head p{ margin:0; color:#667085; }

  .cards{
    display:grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
    gap: 1rem;
  }
  .card{
    background:#fff; border-radius:14px; padding:1rem .95rem;
    box-shadow:0 6px 16px rgba(0,0,0,.06); border:1px solid #eef2f7;
    transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
  }
  .card:hover{
    transform: translateY(-4px);
    border-color:#dbe4ef; box-shadow:0 10px 24px rgba(2,6,23,.08);
  }

  .thumb{
    height:130px; display:flex; align-items:center; justify-content:center;
    background:#f8fafc; border-radius:10px; margin-bottom:.75rem; overflow:hidden;
  }
  .thumb img{ max-width:180px; max-height:120px; width:auto; height:auto; object-fit:contain; border-radius:8px; }

  .name{ font-weight:800; margin:.25rem 0 .35rem; color:#0b1220; text-align:center; }
  .meta, .row{ font-size:.92rem; color:#475569; }
  .meta{ text-align:center; }

  .row{
    display:flex; justify-content:space-between; gap:.75rem; margin-top:.45rem;
  }

  /* tracking row with copy */
  .track-row{ display:flex; justify-content:center; align-items:center; gap:.5rem; margin:.35rem 0 .1rem; }
  .code{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-weight:800; background:#f1f5f9; border:1px solid #e2e8f0;
    padding:.25rem .5rem; border-radius:.5rem; color:#0b1220;
  }
  .copy-btn{
    border:1px solid #e2e8f0; background:#fff; border-radius:.5rem;
    padding:.25rem .5rem; font-weight:700; cursor:pointer;
  }
  .copy-btn:hover{ background:#f8fafc; }

  .badge{
    font-weight:800; font-size:.75rem; padding:.28rem .55rem; border-radius:999px; display:inline-block;
  }
  /* color by status text (lower-cased) */
  .badge[data-status="pending"]{ background:#fef9c3; color:#854d0e; }
  .badge[data-status="approved"]{ background:#dcfce7; color:#166534; }
  .badge[data-status="rejected"]{ background:#fee2e2; color:#991b1b; }
  .badge[data-status="in transit"]{ background:#e0f2fe; color:#075985; }
  .badge[data-status="completed"]{ background:#e9d5ff; color:#6b21a8; }

  .actions{ margin-top:.8rem; display:flex; gap:.5rem; justify-content:center; }
  .btn{
    display:inline-flex; align-items:center; justify-content:center;
    padding:.55rem .95rem; border-radius:.6rem; background:var(--gradient); color:#fff;
    text-decoration:none; font-weight:800; box-shadow:0 6px 14px rgba(34,197,94,.18), 0 2px 4px rgba(0,0,0,.04);
    transition: transform .06s ease, filter .15s ease;
  }
  .btn:hover{ filter:brightness(1.05); transform: translateY(-1px); }
  
  .btn-delete{
    background: #fee2e2;
    color: #991b1b;
    border: 2px solid #fecaca;
    box-shadow: none;
  }
  .btn-delete:hover{
    background: #fecaca;
    border-color: #ef4444;
  }
</style>

<div class="list-wrap">
  <!-- Back -->
  <a href="{% url 'dashboard' %}" class="back-btn" aria-label="Back to Dashboard">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
    </svg>
    Back to Dashboard
  </a>

  <div class="list-head">
    <h2>Track Requests</h2>
    <p>See the status of the medicines you donated.</p>
  </div>

  {% if items %}
    <div class="cards">
      {% for d in items %}
        <div class="card">
          <div class="thumb">
            {% if d.image %}
              <img src="{{ d.image.url }}" alt="{{ d.name }}" loading="lazy">
            {% else %}
              <img src="{% static 'img/placeholder-medicine.png' %}" alt="No image" loading="lazy">
            {% endif %}
          </div>

          <div class="name">{{ d.name }}</div>

          <div class="track-row" title="Tracking code">
            <span class="code" id="code-{{ d.pk }}">{{ d.tracking_code }}</span>
            <button class="copy-btn" type="button" data-target="code-{{ d.pk }}">Copy</button>
          </div>

          <div class="row"><span>Qty</span><span><strong>{{ d.quantity }}</strong></span></div>
          <div class="row"><span>Expiry</span><span><strong>{{ d.expiry_date|date:"M j, Y" }}</strong></span></div>

          <div class="row">
            <span>Status</span>
            <span class="badge" data-status="{{ d.get_status_display|lower }}">{{ d.get_status_display }}</span>
          </div>

          <div class="actions">
            <a class="btn" href="{% url 'request_detail' d.pk %}">View details</a>
            <a class="btn btn-delete" href="{% url 'delete_donation' d.pk %}">üóëÔ∏è Delete</a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p style="text-align:center; color:#667085; margin: .5rem 0 0;">
      You don't have any donations yet.
      <a href="{% url 'donate_medicine' %}" style="font-weight:800; color:var(--blue); text-decoration:none;">Donate now</a>
    </p>
  {% endif %}
</div>

<script>
  // Copy tracking code to clipboard
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.copy-btn');
    if (!btn) return;
    const id = btn.getAttribute('data-target');
    const el = document.getElementById(id);
    if (!el) return;
    const text = el.textContent.trim();
    navigator.clipboard.writeText(text).then(() => {
      const prev = btn.textContent;
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = prev, 1200);
    });
  });
</script>
{% endblock %}
