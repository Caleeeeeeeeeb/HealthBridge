{% extends 'healthbridge_app/base.html' %}
{% load static %}

{% block title %}Dashboard ï¿½ HealthBridge{% endblock %}
{% block nav_dashboard_active %}is-active{% endblock %}

{% block extra_css %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'dashboard/dashboard_modern.css' %}">
{% endblock %}

{% block content %}

<!-- Hero Section -->
<section class="dashboard-hero">
  <div class="hero-content">
    <h1 class="hero-greeting">Welcome back, {{ user.first_name }}! ğŸ‘‹</h1>
    <p class="hero-subtitle">Manage your donations and medicine requests all in one place</p>
    
    <div class="hero-stats">
      <div class="hero-stat">
        <div class="hero-stat-value">{{ total_donations }}</div>
        <div class="hero-stat-label">Total Donations</div>
      </div>
      <div class="hero-stat">
        <div class="hero-stat-value">{{ total_requests }}</div>
        <div class="hero-stat-label">Total Requests</div>
      </div>
      <div class="hero-stat">
        <div class="hero-stat-value">{{ available_medicines_count|default:0 }}</div>
        <div class="hero-stat-label">Available Medicines</div>
      </div>
    </div>
  </div>
</section>

<!-- Quick Actions -->
<div class="quick-actions">
  <div class="action-card" onclick="openDonateModal()">
    <div class="action-card-header">
      <div class="action-icon">ğŸ’Š</div>
      <h3 class="action-card-title">Donate Medicine</h3>
    </div>
    <p class="action-card-desc">Share your unused medicines with those in need</p>
    <button class="action-card-button">
      <span>Donate Now</span>
      <span>â†’</span>
    </button>
  </div>
  
  <div class="action-card" onclick="openRequestModal()">
    <div class="action-card-header">
      <div class="action-icon">ğŸ¥</div>
      <h3 class="action-card-title">Request Medicine</h3>
    </div>
    <p class="action-card-desc">Find the medicines you need from available donations</p>
    <button class="action-card-button">
      <span>Request Now</span>
      <span>â†’</span>
    </button>
  </div>
</div>

<!-- Advanced Stats Grid -->
<div class="stats-showcase">
  <div class="stat-card-modern">
    <div class="stat-header">
      <div class="stat-icon-modern">ğŸ“¦</div>
    </div>
    <div class="stat-value-modern">{{ total_donations }}</div>
    <div class="stat-label-modern">My Donations</div>
    <div class="stat-progress">
      <div class="stat-progress-bar" style="width: 100%"></div>
    </div>
  </div>

  <div class="stat-card-modern">
    <div class="stat-header">
      <div class="stat-icon-modern">âœ…</div>
    </div>
    <div class="stat-value-modern">{{ available_donations }}</div>
    <div class="stat-label-modern">Available to Give</div>
    <div class="stat-progress">
      <div class="stat-progress-bar" style="width: 80%"></div>
    </div>
  </div>

  <div class="stat-card-modern">
    <div class="stat-header">
      <div class="stat-icon-modern">ğŸšš</div>
    </div>
    <div class="stat-value-modern">{{ delivered_donations }}</div>
    <div class="stat-label-modern">Successfully Donated</div>
    <div class="stat-progress">
      <div class="stat-progress-bar" style="width: 90%"></div>
    </div>
  </div>

  <div class="stat-card-modern">
    <div class="stat-header">
      <div class="stat-icon-modern">ğŸ¥</div>
    </div>
    <div class="stat-value-modern">{{ total_requests }}</div>
    <div class="stat-label-modern">My Requests</div>
    <div class="stat-progress">
      <div class="stat-progress-bar" style="width: 100%"></div>
    </div>
  </div>

  <div class="stat-card-modern">
    <div class="stat-header">
      <div class="stat-icon-modern">â³</div>
    </div>
    <div class="stat-value-modern">{{ pending_requests }}</div>
    <div class="stat-label-modern">Pending</div>
    <div class="stat-progress">
      <div class="stat-progress-bar" style="width: 60%"></div>
    </div>
  </div>

  <div class="stat-card-modern">
    <div class="stat-header">
      <div class="stat-icon-modern">ğŸ¯</div>
    </div>
    <div class="stat-value-modern">{{ matched_requests }}</div>
    <div class="stat-label-modern">Matched</div>
    <div class="stat-progress">
      <div class="stat-progress-bar" style="width: 85%"></div>
    </div>
  </div>

  <div class="stat-card-modern">
    <div class="stat-header">
      <div class="stat-icon-modern">ğŸ’Š</div>
    </div>
    <div class="stat-value-modern">{{ available_medicines_count|default:0 }}</div>
    <div class="stat-label-modern">Available Medicines</div>
    <div class="stat-progress">
      <div class="stat-progress-bar" style="width: 75%"></div>
    </div>
  </div>
</div>

<!-- My Donations Section -->
<section class="section-modern">
  <div class="section-header-modern">
    <div class="section-title-wrapper">
      <div class="section-icon-modern">ğŸ“¦</div>
      <h2 class="section-title-modern">My Donations</h2>
    </div>
    <a href="{% url 'donations:my_donations' %}" class="section-action-link">
      View All <span>â†’</span>
    </a>
  </div>

  {% if recent_donations %}
  <div class="donations-grid">
    {% for donation in recent_donations %}
    <div class="donation-card">
      <div class="donation-card-header">
        <h3 class="donation-card-medicine">{{ donation.medicine_name }}</h3>
        <div class="donation-card-meta">
          <span>ğŸ“… {{ donation.created_at|date:"M d, Y" }}</span>
          <span>ğŸ“Š Qty: {{ donation.quantity }}</span>
        </div>
      </div>
      <div class="donation-card-body">
        <div class="donation-info-grid">
          <div class="donation-info-item">
            <div class="donation-info-label">Status</div>
            <div class="donation-info-value">
              <span class="badge-modern badge-{{ donation.status|lower }}">{{ donation.get_status_display }}</span>
            </div>
          </div>
          <div class="donation-info-item">
            <div class="donation-info-label">Expiry</div>
            <div class="donation-info-value">{{ donation.expiry_date|date:"M d, Y" }}</div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state-modern">
    <div class="empty-icon-modern">ğŸ“¦</div>
    <h3 class="empty-title">No donations yet</h3>
    <p class="empty-desc">Start making a difference by donating your unused medicines</p>
    <button class="empty-action" onclick="openDonateModal()">
      <span>Donate Medicine</span>
      <span>â†’</span>
    </button>
  </div>
  {% endif %}
</section>

<!-- My Requests History Section -->
<section class="section-modern">
  <div class="section-header-modern">
    <div class="section-title-wrapper">
      <div class="section-icon-modern">ğŸ“‹</div>
      <h2 class="section-title-modern">My Requests</h2>
    </div>
    <a href="{% url 'requests:track_medicine_requests' %}" class="section-action-link">
      View All <span>â†’</span>
    </a>
  </div>

  {% if recent_requests %}
  <div class="table-container">
    <table class="table-modern">
      <thead>
        <tr>
          <th>Medicine</th>
          <th>Quantity</th>
          <th>Urgency</th>
          <th>Status</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        {% for request in recent_requests %}
        <tr>
          <td>
            <div class="table-medicine-name">
              <div class="medicine-avatar">{{ request.medicine_name|first|upper }}</div>
              {{ request.medicine_name }}
            </div>
          </td>
          <td>{{ request.quantity_needed }}</td>
          <td>
            {% if request.urgency == 'critical' %}
              <span class="badge-modern badge-danger">ğŸ”´ Critical</span>
            {% elif request.urgency == 'high' %}
              <span class="badge-modern badge-warning">ğŸŸ  High</span>
            {% elif request.urgency == 'medium' %}
              <span class="badge-modern badge-info">ğŸŸ¡ Medium</span>
            {% else %}
              <span class="badge-modern badge-success">ğŸŸ¢ Low</span>
            {% endif %}
          </td>
          <td>
            <span class="badge-modern badge-{{ request.status|lower }}">{{ request.get_status_display }}</span>
          </td>
          <td>{{ request.created_at|date:"M d, Y" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state-modern">
    <div class="empty-icon-modern">ğŸ“‹</div>
    <h3 class="empty-title">No requests yet</h3>
    <p class="empty-desc">Start by making your first medicine request</p>
    <button class="empty-action" onclick="openRequestModal()">
      <span>Request Medicine</span>
      <span>â†’</span>
    </button>
  </div>
  {% endif %}
</section>

<!-- Donate Medicine Modal -->
<div class="modal-overlay" id="donateModal">
  <div class="modal-container">
    <div class="modal-header">
      <button class="modal-close" onclick="closeDonateModal()">âœ•</button>
      <h2 class="modal-title">
        <span>ğŸ’Š</span>
        Donate Medicine
      </h2>
      <p class="modal-subtitle">Help others by donating unused or surplus medicines</p>
    </div>
    <div class="modal-body">
      <form id="donateForm" data-submit-url="{% url 'donations:donate_medicine' %}" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form-group">
          <label class="form-label">
            <span>ğŸ’Š</span>
            Medicine Name
          </label>
          <input type="text" name="name" class="form-input" placeholder="Enter medicine name" required>
          <p class="form-help">â„¹ï¸ Enter the full name of the medicine</p>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span>ğŸ“Š</span>
            Quantity
          </label>
          <input type="number" name="quantity" class="form-input" placeholder="Enter quantity" min="1" required>
          <p class="form-help">â„¹ï¸ Number of units you're donating</p>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span>ğŸ“…</span>
            Expiry Date
          </label>
          <input type="date" name="expiry_date" class="form-input" required>
          <p class="form-help">âš ï¸ Please provide accurate expiry information</p>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span>ğŸ“·</span>
            Medicine Image (Optional)
          </label>
          <input type="file" name="image" class="form-input" accept="image/*">
          <p class="form-help">ğŸ“¸ Upload a clear photo of the medicine packaging</p>
        </div>

        <div class="modal-actions">
          <button type="button" class="modal-btn modal-btn-secondary" onclick="closeDonateModal()">
            Cancel
          </button>
          <button type="submit" class="modal-btn modal-btn-primary">
            <span>âœ¨</span>
            Donate Now
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Request Medicine Modal -->
<div class="modal-overlay" id="requestModal">
  <div class="modal-container">
    <div class="modal-header">
      <button class="modal-close" onclick="closeRequestModal()">âœ•</button>
      <h2 class="modal-title">
        <span>ğŸ¥</span>
        Request Medicine
      </h2>
      <p class="modal-subtitle">Tell us what medicine you need and we'll try to match you with a donor</p>
    </div>
    <div class="modal-body">
      <form id="requestForm" data-submit-url="{% url 'requests:request_medicine' %}">
        {% csrf_token %}
        
        <div class="form-group">
          <label class="form-label">
            <span>ğŸ’Š</span>
            Medicine Name
          </label>
          <input type="text" name="medicine_name" class="form-input" placeholder="Start typing medicine name..." required>
          <p class="form-help">â„¹ï¸ Enter the medicine you need</p>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span>ğŸ“Š</span>
            Quantity Needed
          </label>
          <input type="number" name="quantity_needed" class="form-input" placeholder="Enter quantity" min="1" required>
          <p class="form-help">â„¹ï¸ How many units do you need?</p>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span>âš¡</span>
            Urgency Level
          </label>
          <select name="urgency" class="form-input" required>
            <option value="low">ğŸŸ¢ Low - Not urgent</option>
            <option value="medium" selected>ğŸŸ¡ Medium - Needed soon</option>
            <option value="high">ğŸŸ  High - Needed urgently</option>
            <option value="critical">ğŸ”´ Critical - Emergency</option>
          </select>
          <p class="form-help">â„¹ï¸ Select the urgency level of your request</p>
        </div>

        <div class="form-group">
          <label class="form-label">
            <span>ğŸ“</span>
            Reason (Optional)
          </label>
          <textarea name="reason" class="form-input" rows="3" placeholder="Why do you need this medicine?"></textarea>
          <p class="form-help">ğŸ’¡ Providing details helps us prioritize urgent requests</p>
        </div>

        <div class="modal-actions">
          <button type="button" class="modal-btn modal-btn-secondary" onclick="closeRequestModal()">
            Cancel
          </button>
          <button type="submit" class="modal-btn modal-btn-primary">
            <span>âœ¨</span>
            Submit Request
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="{% static 'dashboard/dashboard.js' %}"></script>

{% endblock %}
